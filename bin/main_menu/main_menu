#!/bin/env python
from pathlib import Path
from subprocess import run
from collections import OrderedDict
import os
import re

from rofi import Rofi
from rofi_menu import menu

menu_dir = Path.home()/'.bin/main_menu'
dot_bin  = Path.home()/'.bin'
r = Rofi(rofi_args=['-i'])

menu_items = {
    'Launcher': lambda: run([dot_bin/'launcher']),
    'Run': lambda: run(['rofi', '-modi', 'run', '-show', 'run']),
    'Edit dotfiles':
        lambda: run([os.environ.get('EDITOR'), Path.home()/'.config/dotfiles']),
    'Reload config':
        lambda: run([Path.home()/'.config/bspwm/bspwmrc']),
}

# We will only consider files ending in .menu
namematcher = re.compile(r'(.+)\.menu')
for menu_file in menu_dir.iterdir():
    name_match = namematcher.match(menu_file.name)
    if name_match is not None:
        menu_items[name_match[1]] = lambda target=menu_file: run([target])

# Sort by name before displaying
menu(r, 'Search', OrderedDict(sorted(menu_items.items())))
